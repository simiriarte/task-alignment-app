<!-- Vertical Sidebar Navigation -->
<nav class="dashboard-nav">
  <div class="nav-container">
    <ul class="nav-tabs">
      <li class="nav-tab active">
        <%= link_to root_path do %>
          <span class="nav-icon">
            <%= home_icon(css_class: "icon") %>
          </span>
          <span class="nav-label">Dashboard</span>
        <% end %>
      </li>
      <li class="nav-tab">
        <%= link_to tasks_path do %>
          <span class="nav-icon">
            <%= document_icon(css_class: "icon") %>
          </span>
          <span class="nav-label">Tasks</span>
        <% end %>
      </li>
      <li class="nav-tab">
        <%= link_to "#" do %>
          <span class="nav-icon">
            <%= calendar_icon(css_class: "icon") %>
          </span>
          <span class="nav-label">Calendar</span>
        <% end %>
      </li>
      <li class="nav-tab">
        <%= link_to "#" do %>
          <span class="nav-icon">
            <%= clock_icon(css_class: "icon") %>
          </span>
          <span class="nav-label">Pain Cave</span>
        <% end %>
      </li>
    </ul>
    
    <% if user_signed_in? %>
      <div class="nav-profile">
        <div class="profile-trigger">
          <% if current_user.profile_photo.present? %>
            <img src="<%= current_user.profile_photo %>" alt="Profile Photo" class="profile-photo">
          <% else %>
            <%= user_icon(css_class: "profile-avatar") %>
          <% end %>
        </div>
        <div class="profile-menu">
          <a href="#" class="profile-menu-item" id="profileMenuTrigger">
            <span class="nav-icon">
              <%= user_icon(css_class: "icon") %>
            </span>
            <span class="nav-label">Profile</span>
          </a>
          <%= link_to "#", class: "profile-menu-item" do %>
            <span class="nav-icon">
              <%= settings_icon(css_class: "icon") %>
            </span>
            <span class="nav-label">Settings</span>
          <% end %>
          <%= link_to destroy_user_session_path, data: { turbo_method: :delete }, class: "profile-menu-item" do %>
            <span class="nav-icon">
              <%= logout_icon(css_class: "icon") %>
            </span>
            <span class="nav-label">Sign Out</span>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</nav>

<!-- Main Content Area -->
<div class="main-content">
  <div class="dashboard-welcome">
    <% if user_signed_in? %>
      <!-- Welcome Section -->
      <div class="welcome-section">
        <h1 class="welcome-title">Welcome to Task Alignment</h1>
        <p class="welcome-description">
          Task Alignment helps you align your daily actions with your deeper values and goals, creating a holistic approach to getting things done. Move beyond simple to-do lists to experience productivity with meaning and personal fulfillment.
        </p>
      </div>

      <!-- Action Section -->
      <div class="action-section">
        <%= link_to "Create Your First Task", tasks_path, class: "btn btn-large", style: "background-color: #ff8900; color: white; border-radius: 50px; border: none; padding: 12px 32px; font-weight: 500; text-decoration: none; display: inline-block; transition: all 0.2s ease;" %>
      </div>

      <!-- Coming Soon Features -->
      <div class="coming-soon-section">
        <div class="coming-soon-accordion">
          <div class="accordion-header" style="background: linear-gradient(135deg, #0097f2 0%, #0084d1 100%); color: white; border-radius: 8px 8px 0 0; padding: 16px;">
            <h2 class="accordion-title" style="color: white; margin: 0;">Coming Soon</h2>
          </div>
          
          <div class="accordion-content">
            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Task Alignment</span>
                </div>
                <div class="accordion-item-right">
                  <span class="status-indicator status-in-progress">In Progress</span>
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Smart prioritization based on your values and energy</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Calendar Integration</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Unified view of tasks and events with smart scheduling</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Astrology Integration</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Cosmic timing for optimal productivity and alignment</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 4.5v15m7.5-7.5h-15"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Quick Capture</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Instant task capture on mobile and desktop</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Life Audit</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Set your baseline and track progress on personal growth and alignment</p>
              </div>
            </div>
          </div>
        </div>
      </div>

    <% else %>
      <!-- Non-signed-in welcome -->
      <div class="welcome-section">
        <h1 class="welcome-title">Welcome to Task Alignment</h1>
        <p class="welcome-description">
          Task Alignment helps you align your daily actions with your deeper values and goals, creating a holistic approach to getting things done.
        </p>
      </div>

      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <%= link_to "Sign Up", new_user_registration_path, class: "inline-flex justify-center items-center px-6 py-3 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
        <%= link_to "Sign In", new_user_session_path, class: "inline-flex justify-center items-center px-6 py-3 border border-gray-300 rounded-md shadow-sm text-base font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Profile Photo Modal -->
<% if user_signed_in? %>
  <div class="profile-modal" id="profileModal">
    <div class="profile-modal-header">
      <h3 class="profile-modal-title">Profile Photo</h3>
      <button class="profile-modal-close" id="profileModalClose">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="profile-modal-content">
      <div class="profile-photo-preview" id="profilePhotoPreview">
        <% if current_user.profile_photo.present? %>
          <img src="<%= current_user.profile_photo %>" alt="Profile Photo" id="profilePhotoImg">
        <% else %>
          <svg class="profile-photo-preview-placeholder" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
          </svg>
        <% end %>
      </div>
      <div class="profile-photo-upload">
        <input type="file" class="profile-photo-input" id="profilePhotoInput" accept="image/*">
        <button class="profile-photo-button" id="profilePhotoButton">
          Choose Photo
        </button>
        <% if current_user.profile_photo.present? %>
          <button class="profile-photo-button secondary" id="removePhotoButton">
            Remove Photo
          </button>
        <% end %>
      </div>
      <div class="profile-modal-actions">
        <button class="btn-cancel" id="profileModalCancel">Cancel</button>
        <button class="btn-save" id="profileModalSave" disabled>Save</button>
      </div>
    </div>
  </div>
<% end %>

<script>
  // Direct accordion functionality to ensure it works
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, setting up accordion...');
    
    // Wait a bit for everything to be ready
    setTimeout(function() {
      const accordionTriggers = document.querySelectorAll('[data-accordion-trigger]');
      console.log('Found accordion triggers:', accordionTriggers.length);
      
      accordionTriggers.forEach(function(trigger, index) {
        console.log('Setting up trigger', index);
        
        trigger.addEventListener('click', function(e) {
          console.log('Accordion clicked!');
          e.preventDefault();
          e.stopPropagation();
          
          const accordionItem = this.closest('.accordion-item');
          const isExpanded = accordionItem.classList.contains('expanded');
          
          console.log('Item expanded:', isExpanded);
          
          // Close all accordion items first
          document.querySelectorAll('.accordion-item').forEach(function(item) {
            item.classList.remove('expanded');
          });
          
          // Open clicked item if it wasn't already open
          if (!isExpanded) {
            accordionItem.classList.add('expanded');
            console.log('Expanding item');
          }
        });
      });
    }, 200);
  });
  
  // Also try on turbo:load for Rails
  document.addEventListener('turbo:load', function() {
    console.log('Turbo loaded, setting up accordion...');
    
    setTimeout(function() {
      const accordionTriggers = document.querySelectorAll('[data-accordion-trigger]');
      console.log('Found accordion triggers (turbo):', accordionTriggers.length);
      
      accordionTriggers.forEach(function(trigger, index) {
        // Remove existing listeners to prevent duplicates
        const newTrigger = trigger.cloneNode(true);
        trigger.parentNode.replaceChild(newTrigger, trigger);
        
        newTrigger.addEventListener('click', function(e) {
          console.log('Accordion clicked (turbo)!');
          e.preventDefault();
          e.stopPropagation();
          
          const accordionItem = this.closest('.accordion-item');
          const isExpanded = accordionItem.classList.contains('expanded');
          
          // Close all accordion items first
          document.querySelectorAll('.accordion-item').forEach(function(item) {
            item.classList.remove('expanded');
          });
          
          // Open clicked item if it wasn't already open
          if (!isExpanded) {
            accordionItem.classList.add('expanded');
          }
        });
      });
    }, 200);
  });
</script>

