<!-- Vertical Sidebar Navigation -->
<nav class="dashboard-nav">
  <div class="nav-container">
    <ul class="nav-tabs">
      <li class="nav-tab active">
        <%= link_to root_path do %>
          <span class="nav-icon">
            <%= home_icon(css_class: "icon") %>
          </span>
          <span class="nav-label">Dashboard</span>
        <% end %>
      </li>
      <li class="nav-tab">
        <%= link_to tasks_path do %>
          <span class="nav-icon">
            <%= document_icon(css_class: "icon") %>
          </span>
          <span class="nav-label">Tasks</span>
        <% end %>
      </li>
      <li class="nav-tab">
        <%= link_to "#" do %>
          <span class="nav-icon">
            <%= calendar_icon(css_class: "icon") %>
          </span>
          <span class="nav-label">Calendar</span>
        <% end %>
      </li>
      <li class="nav-tab">
        <%= link_to "#" do %>
          <span class="nav-icon">
            <%= clock_icon(css_class: "icon") %>
          </span>
          <span class="nav-label">Pain Cave</span>
        <% end %>
      </li>
    </ul>
    
    <% if user_signed_in? %>
      <div class="nav-profile">
        <div class="profile-trigger">
          <% if current_user.profile_photo.present? %>
            <img src="<%= current_user.profile_photo %>" alt="Profile Photo" class="profile-photo">
          <% else %>
            <%= user_icon(css_class: "profile-avatar") %>
          <% end %>
        </div>
        <div class="profile-menu">
          <a href="#" class="profile-menu-item" id="profileMenuTrigger">
            <span class="profile-menu-label">Profile</span>
          </a>
          <%= link_to "#", class: "profile-menu-item" do %>
            <span class="profile-menu-label">Settings</span>
          <% end %>
          <%= link_to destroy_user_session_path, data: { turbo_method: :delete }, class: "profile-menu-item" do %>
            <span class="profile-menu-label">Sign Out</span>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</nav>

<!-- Main Content Area -->
<div class="main-content">
  <div class="dashboard-welcome">
    <% if user_signed_in? %>
      <!-- Welcome Section -->
      <div class="welcome-section">
        <h1 class="welcome-title">Welcome to Task Alignment</h1>
        <p class="welcome-description">
          Task Alignment helps you align your daily actions with your deeper values and goals, creating a holistic approach to getting things done. Move beyond simple to-do lists to experience productivity with meaning and personal fulfillment.
        </p>
      </div>

      <!-- Action Section -->
      <div class="action-section">
        <%= link_to "Create Your First Task", tasks_path, class: "btn btn-primary btn-large btn-rounded" %>
      </div>

      <!-- Coming Soon Features -->
      <div class="coming-soon-section">
        <div class="coming-soon-accordion">
          <div class="accordion-header">
            <h2 class="accordion-title">Coming Soon</h2>
          </div>
          
          <div class="accordion-content">
            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Task Alignment</span>
                </div>
                <div class="accordion-item-right">
                  <span class="status-indicator status-in-progress">In Progress</span>
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Smart prioritization based on your values and energy</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Calendar Integration</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Unified view of tasks and events with smart scheduling</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Astrology Integration</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Cosmic timing for optimal productivity and alignment</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 4.5v15m7.5-7.5h-15"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Quick Capture</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Instant task capture on mobile and desktop</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Life Audit</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Set your baseline and track progress on personal growth and alignment</p>
              </div>
            </div>
          </div>
        </div>
      </div>

    <% else %>
      <!-- Non-signed-in welcome -->
      <div class="welcome-section">
        <h1 class="welcome-title">Welcome to Task Alignment</h1>
        <p class="welcome-description">
          Task Alignment helps you align your daily actions with your deeper values and goals, creating a holistic approach to getting things done.
        </p>
      </div>

      <div class="auth-actions">
        <%= link_to "Sign Up", new_user_registration_path, class: "btn btn-primary btn-large" %>
        <%= link_to "Sign In", new_user_session_path, class: "btn btn-outline btn-large" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Profile Photo Modal -->
<% if user_signed_in? %>
  <div class="profile-modal" id="profileModal">
    <div class="profile-modal-header">
      <h3 class="profile-modal-title">Profile Photo</h3>
      <button class="profile-modal-close" id="profileModalClose">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="profile-modal-content">
      <div class="profile-photo-preview" id="profilePhotoPreview">
        <% if current_user.profile_photo.present? %>
          <img src="<%= current_user.profile_photo %>" alt="Profile Photo" id="profilePhotoImg">
        <% else %>
          <svg class="profile-photo-preview-placeholder" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
          </svg>
        <% end %>
      </div>
      <div class="profile-photo-upload">
        <input type="file" class="profile-photo-input" id="profilePhotoInput" accept="image/*">
        <button class="profile-photo-button" id="profilePhotoButton">
          Choose Photo
        </button>
        <% if current_user.profile_photo.present? %>
          <button class="profile-photo-button secondary" id="removePhotoButton">
            Remove Photo
          </button>
        <% end %>
      </div>
      <div class="profile-modal-actions">
        <button class="btn-cancel" id="profileModalCancel">Cancel</button>
        <button class="btn-save" id="profileModalSave" disabled>Save</button>
      </div>
    </div>
  </div>
<% end %>

<script>
  // Direct accordion functionality to ensure it works
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, setting up accordion...');
    
    // Wait a bit for everything to be ready
    setTimeout(function() {
      const accordionTriggers = document.querySelectorAll('[data-accordion-trigger]');
      console.log('Found accordion triggers:', accordionTriggers.length);
      
      accordionTriggers.forEach(function(trigger, index) {
        console.log('Setting up trigger', index);
        
        trigger.addEventListener('click', function(e) {
          console.log('Accordion clicked!');
          e.preventDefault();
          e.stopPropagation();
          
          const accordionItem = this.closest('.accordion-item');
          const isExpanded = accordionItem.classList.contains('expanded');
          
          console.log('Item expanded:', isExpanded);
          
          // Close all accordion items first
          document.querySelectorAll('.accordion-item').forEach(function(item) {
            item.classList.remove('expanded');
          });
          
          // Open clicked item if it wasn't already open
          if (!isExpanded) {
            accordionItem.classList.add('expanded');
            console.log('Expanding item');
          }
        });
      });
    }, 200);
  });
  
  // Also try on turbo:load for Rails
  document.addEventListener('turbo:load', function() {
    console.log('Turbo loaded, setting up accordion...');
    
    setTimeout(function() {
      const accordionTriggers = document.querySelectorAll('[data-accordion-trigger]');
      console.log('Found accordion triggers (turbo):', accordionTriggers.length);
      
      accordionTriggers.forEach(function(trigger, index) {
        // Remove existing listeners to prevent duplicates
        const newTrigger = trigger.cloneNode(true);
        trigger.parentNode.replaceChild(newTrigger, trigger);
        
        newTrigger.addEventListener('click', function(e) {
          console.log('Accordion clicked (turbo)!');
          e.preventDefault();
          e.stopPropagation();
          
          const accordionItem = this.closest('.accordion-item');
          const isExpanded = accordionItem.classList.contains('expanded');
          
          // Close all accordion items first
          document.querySelectorAll('.accordion-item').forEach(function(item) {
            item.classList.remove('expanded');
          });
          
          // Open clicked item if it wasn't already open
          if (!isExpanded) {
            accordionItem.classList.add('expanded');
          }
        });
      });
    }, 200);
  });
</script>

<%# Icon System Demo Section %>
<div class="container">
  <div class="icon-demo-section" style="margin-bottom: 40px;">
    <h2>ðŸŽ¨ Icon System Demo</h2>
    <p>Here's how to use all the available icons in your templates:</p>
    
    <%# Basic Icon Usage %>
    <div class="demo-block" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h3>Basic Icon Usage</h3>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 20px;">
        <%= plus_icon %> plus_icon
        <%= edit_icon %> edit_icon
        <%= calendar_icon %> calendar_icon
        <%= document_icon %> document_icon
        <%= delete_icon %> delete_icon
        <%= check_icon %> check_icon
        <%= star_icon %> star_icon
        <%= user_icon %> user_icon
        <%= settings_icon %> settings_icon
        <%= home_icon %> home_icon
      </div>
      <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; font-size: 14px;">
        &lt;%= plus_icon %&gt; &lt;%= edit_icon %&gt; &lt;%= calendar_icon %&gt;
      </code>
    </div>

    <%# Icon Sizes %>
    <div class="demo-block" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h3>Icon Sizes</h3>
      <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 20px;">
        <%= edit_icon(size: :xs) %> xs
        <%= edit_icon(size: :sm) %> sm
        <%= edit_icon(size: :md) %> md
        <%= edit_icon(size: :lg) %> lg
        <%= edit_icon(size: :xl) %> xl
        <%= edit_icon(size: :"2xl") %> 2xl
      </div>
      <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; font-size: 14px;">
        &lt;%= edit_icon(size: :xs) %&gt; &lt;%= edit_icon(size: :lg) %&gt;
      </code>
    </div>

    <%# Icon Colors %>
    <div class="demo-block" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h3>Icon Colors</h3>
      <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 20px;">
        <%= star_icon(css_class: "icon-primary") %> primary
        <%= star_icon(css_class: "icon-accent") %> accent
        <%= star_icon(css_class: "icon-success") %> success
        <%= star_icon(css_class: "icon-warning") %> warning
        <%= star_icon(css_class: "icon-error") %> error
        <%= star_icon(css_class: "icon-muted") %> muted
      </div>
      <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; font-size: 14px;">
        &lt;%= star_icon(css_class: "icon-primary") %&gt;
      </code>
    </div>

    <%# Icon Buttons %>
    <div class="demo-block" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h3>Icon Buttons</h3>
      <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 20px;">
        <button class="btn-icon">
          <%= edit_icon %>
        </button>
        <button class="btn-icon btn-icon-primary">
          <%= plus_icon %>
        </button>
        <button class="btn-icon btn-icon-accent">
          <%= star_icon %>
        </button>
        <button class="btn-icon btn-icon-danger">
          <%= delete_icon %>
        </button>
      </div>
      <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; font-size: 14px;">
        &lt;button class="btn-icon btn-icon-primary"&gt;&lt;%= plus_icon %&gt;&lt;/button&gt;
      </code>
    </div>

    <%# Text with Icons %>
    <div class="demo-block" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h3>Text with Icons</h3>
      <div style="margin-bottom: 20px;">
        <div class="icon-with-text" style="margin-bottom: 10px;">
          <%= plus_icon %> Add New Task
        </div>
        <div class="icon-with-text" style="margin-bottom: 10px;">
          <%= calendar_icon %> Schedule Meeting
        </div>
        <div class="icon-with-text" style="margin-bottom: 10px;">
          <%= document_icon %> View Document
        </div>
      </div>
      <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; font-size: 14px;">
        &lt;div class="icon-with-text"&gt;&lt;%= plus_icon %&gt; Add New Task&lt;/div&gt;
      </code>
    </div>

    <%# Buttons with Icons %>
    <div class="demo-block" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h3>Buttons with Icons</h3>
      <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 20px;">
        <button class="btn btn-primary">
          <%= plus_icon %> Add Task
        </button>
        <button class="btn btn-outline">
          <%= edit_icon %> Edit
        </button>
        <button class="btn btn-outline">
          <%= calendar_icon %> Schedule
        </button>
      </div>
      <code style="background: #f5f5f5; padding: 4px 8px; border-radius: 4px; font-size: 14px;">
        &lt;button class="btn btn-primary"&gt;&lt;%= plus_icon %&gt; Add Task&lt;/button&gt;
      </code>
    </div>

    <%# All Available Icons %>
    <div class="demo-block" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h3>All Available Icons</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 20px;">
        <% [
          { name: "plus_icon", icon: plus_icon },
          { name: "edit_icon", icon: edit_icon },
          { name: "calendar_icon", icon: calendar_icon },
          { name: "document_icon", icon: document_icon },
          { name: "chevron_right_icon", icon: chevron_right_icon },
          { name: "chevron_down_icon", icon: chevron_down_icon },
          { name: "chevron_left_icon", icon: chevron_left_icon },
          { name: "delete_icon", icon: delete_icon },
          { name: "check_icon", icon: check_icon },
          { name: "star_icon", icon: star_icon },
          { name: "user_icon", icon: user_icon },
          { name: "settings_icon", icon: settings_icon },
          { name: "home_icon", icon: home_icon },
          { name: "menu_icon", icon: menu_icon },
          { name: "close_icon", icon: close_icon },
          { name: "search_icon", icon: search_icon },
          { name: "filter_icon", icon: filter_icon },
          { name: "sort_icon", icon: sort_icon },
          { name: "notification_icon", icon: notification_icon },
          { name: "eye_icon", icon: eye_icon },
          { name: "link_icon", icon: link_icon },
          { name: "clock_icon", icon: clock_icon },
          { name: "folder_icon", icon: folder_icon },
          { name: "tag_icon", icon: tag_icon },
          { name: "flag_icon", icon: flag_icon },
          { name: "archive_icon", icon: archive_icon },
          { name: "download_icon", icon: download_icon },
          { name: "upload_icon", icon: upload_icon },
          { name: "share_icon", icon: share_icon },
          { name: "copy_icon", icon: copy_icon },
          { name: "heart_icon", icon: heart_icon },
          { name: "info_icon", icon: info_icon },
          { name: "warning_icon", icon: warning_icon },
          { name: "error_icon", icon: error_icon },
          { name: "success_icon", icon: success_icon }
        ].each do |item| %>
          <div class="icon-with-text" style="font-size: 14px; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px;">
            <%= item[:icon] %> <%= item[:name] %>
          </div>
        <% end %>
      </div>
    </div>

    <%# Usage Instructions %>
    <div class="demo-block" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #4299e1;">
      <h3>How to Use</h3>
      <ul style="margin-left: 20px; line-height: 1.6;">
        <li><strong>Basic usage:</strong> <code>&lt;%= plus_icon %&gt;</code></li>
        <li><strong>With size:</strong> <code>&lt;%= plus_icon(size: :lg) %&gt;</code></li>
        <li><strong>With color:</strong> <code>&lt;%= plus_icon(css_class: "icon-primary") %&gt;</code></li>
        <li><strong>With custom class:</strong> <code>&lt;%= plus_icon(css_class: "my-custom-class") %&gt;</code></li>
        <li><strong>Direct icon usage:</strong> <code>&lt;%= icon("heart", variant: :solid, size: :lg) %&gt;</code></li>
        <li><strong>With text:</strong> Wrap in <code>&lt;div class="icon-with-text"&gt;</code></li>
      </ul>
    </div>
  </div>
</div>
