<!-- Vertical Sidebar Navigation -->
<nav class="dashboard-nav">
  <div class="nav-container">
    <ul class="nav-tabs">
      <li class="nav-tab active">
        <%= link_to root_path do %>
          <span class="nav-icon">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"/>
            </svg>
          </span>
          <span class="nav-label">Dashboard</span>
        <% end %>
      </li>
      <li class="nav-tab">
        <%= link_to tasks_path do %>
          <span class="nav-icon">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"/>
            </svg>
          </span>
          <span class="nav-label">Tasks</span>
        <% end %>
      </li>
      <li class="nav-tab">
        <%= link_to "#" do %>
          <span class="nav-icon">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"/>
            </svg>
          </span>
          <span class="nav-label">Calendar</span>
        <% end %>
      </li>
      <li class="nav-tab">
        <%= link_to "#" do %>
          <span class="nav-icon">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
            </svg>
          </span>
          <span class="nav-label">Pain Cave</span>
        <% end %>
      </li>
    </ul>
    
    <% if user_signed_in? %>
      <div class="nav-profile">
        <div class="profile-trigger">
          <% if current_user.profile_photo.present? %>
            <img src="<%= current_user.profile_photo %>" alt="Profile Photo" class="profile-photo">
          <% else %>
            <svg class="profile-avatar" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
            </svg>
          <% end %>
        </div>
        <div class="profile-menu">
          <a href="#" class="profile-menu-item" id="profileMenuTrigger">
            <span class="profile-menu-label">Profile</span>
          </a>
          <%= link_to "#", class: "profile-menu-item" do %>
            <span class="profile-menu-label">Settings</span>
          <% end %>
          <%= link_to destroy_user_session_path, data: { turbo_method: :delete }, class: "profile-menu-item" do %>
            <span class="profile-menu-label">Sign Out</span>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</nav>

<!-- Main Content Area -->
<div class="main-content">
  <div class="dashboard-welcome">
    <% if user_signed_in? %>
      <!-- Welcome Section -->
      <div class="welcome-section">
        <h1 class="welcome-title">Welcome to Task Alignment</h1>
        <p class="welcome-description">
          Task Alignment helps you align your daily actions with your deeper values and goals, creating a holistic approach to getting things done. Move beyond simple to-do lists to experience productivity with meaning and personal fulfillment.
        </p>
      </div>

      <!-- Action Section -->
      <div class="action-section">
        <%= link_to "Create Your First Task", tasks_path, class: "btn btn-primary btn-large btn-rounded" %>
      </div>

      <!-- Coming Soon Features -->
      <div class="coming-soon-section">
        <div class="coming-soon-accordion">
          <div class="accordion-header">
            <h2 class="accordion-title">Coming Soon</h2>
          </div>
          
          <div class="accordion-content">
            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Task Alignment</span>
                </div>
                <div class="accordion-item-right">
                  <span class="status-indicator status-in-progress">In Progress</span>
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Smart prioritization based on your values and energy</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Calendar Integration</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Unified view of tasks and events with smart scheduling</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Astrology Integration</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Cosmic timing for optimal productivity and alignment</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 4.5v15m7.5-7.5h-15"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Quick Capture</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Instant task capture on mobile and desktop</p>
              </div>
            </div>

            <div class="accordion-item">
              <div class="accordion-item-header" data-accordion-trigger>
                <div class="accordion-item-left">
                  <div class="accordion-item-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                    </svg>
                  </div>
                  <span class="accordion-item-title">Life Audit</span>
                </div>
                <div class="accordion-item-right">
                  <div class="accordion-chevron">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M19 9l-7 7-7-7"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="accordion-item-content">
                <p>Set your baseline and track progress on personal growth and alignment</p>
              </div>
            </div>
          </div>
        </div>
      </div>

    <% else %>
      <!-- Non-signed-in welcome -->
      <div class="welcome-section">
        <h1 class="welcome-title">Welcome to Task Alignment</h1>
        <p class="welcome-description">
          Task Alignment helps you align your daily actions with your deeper values and goals, creating a holistic approach to getting things done.
        </p>
      </div>

      <div class="auth-actions">
        <%= link_to "Sign Up", new_user_registration_path, class: "btn btn-primary btn-large" %>
        <%= link_to "Sign In", new_user_session_path, class: "btn btn-outline btn-large" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Profile Photo Modal -->
<% if user_signed_in? %>
  <div class="profile-modal" id="profileModal">
    <div class="profile-modal-header">
      <h3 class="profile-modal-title">Profile Photo</h3>
      <button class="profile-modal-close" id="profileModalClose">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="profile-modal-content">
      <div class="profile-photo-preview" id="profilePhotoPreview">
        <% if current_user.profile_photo.present? %>
          <img src="<%= current_user.profile_photo %>" alt="Profile Photo" id="profilePhotoImg">
        <% else %>
          <svg class="profile-photo-preview-placeholder" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
          </svg>
        <% end %>
      </div>
      <div class="profile-photo-upload">
        <input type="file" class="profile-photo-input" id="profilePhotoInput" accept="image/*">
        <button class="profile-photo-button" id="profilePhotoButton">
          Choose Photo
        </button>
        <% if current_user.profile_photo.present? %>
          <button class="profile-photo-button secondary" id="removePhotoButton">
            Remove Photo
          </button>
        <% end %>
      </div>
      <div class="profile-modal-actions">
        <button class="btn-cancel" id="profileModalCancel">Cancel</button>
        <button class="btn-save" id="profileModalSave" disabled>Save</button>
      </div>
    </div>
  </div>
<% end %>

<script>
  // Direct accordion functionality to ensure it works
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, setting up accordion...');
    
    // Wait a bit for everything to be ready
    setTimeout(function() {
      const accordionTriggers = document.querySelectorAll('[data-accordion-trigger]');
      console.log('Found accordion triggers:', accordionTriggers.length);
      
      accordionTriggers.forEach(function(trigger, index) {
        console.log('Setting up trigger', index);
        
        trigger.addEventListener('click', function(e) {
          console.log('Accordion clicked!');
          e.preventDefault();
          e.stopPropagation();
          
          const accordionItem = this.closest('.accordion-item');
          const isExpanded = accordionItem.classList.contains('expanded');
          
          console.log('Item expanded:', isExpanded);
          
          // Close all accordion items first
          document.querySelectorAll('.accordion-item').forEach(function(item) {
            item.classList.remove('expanded');
          });
          
          // Open clicked item if it wasn't already open
          if (!isExpanded) {
            accordionItem.classList.add('expanded');
            console.log('Expanding item');
          }
        });
      });
    }, 200);
  });
  
  // Also try on turbo:load for Rails
  document.addEventListener('turbo:load', function() {
    console.log('Turbo loaded, setting up accordion...');
    
    setTimeout(function() {
      const accordionTriggers = document.querySelectorAll('[data-accordion-trigger]');
      console.log('Found accordion triggers (turbo):', accordionTriggers.length);
      
      accordionTriggers.forEach(function(trigger, index) {
        // Remove existing listeners to prevent duplicates
        const newTrigger = trigger.cloneNode(true);
        trigger.parentNode.replaceChild(newTrigger, trigger);
        
        newTrigger.addEventListener('click', function(e) {
          console.log('Accordion clicked (turbo)!');
          e.preventDefault();
          e.stopPropagation();
          
          const accordionItem = this.closest('.accordion-item');
          const isExpanded = accordionItem.classList.contains('expanded');
          
          // Close all accordion items first
          document.querySelectorAll('.accordion-item').forEach(function(item) {
            item.classList.remove('expanded');
          });
          
          // Open clicked item if it wasn't already open
          if (!isExpanded) {
            accordionItem.classList.add('expanded');
          }
        });
      });
    }, 200);
  });
</script>
